using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace TestMODBUS.Models.ModbusCommands
{
    public static class ModBusCommandsList
    {
        private static readonly byte[] CRC16Hi = new byte[]
        {
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64,
            1,
            192,
            128,
            65,
            1,
            192,
            128,
            65,
            0,
            193,
            129,
            64
        };

        static private byte[] _getModuleNameCommand = new byte[]
        {
            0x01, 
            0x46, 
            0x00
        };

        static private byte[] _readChannelCommandBase = new byte[]
        {
            0x01, //0
            0x04, //1
            0x00, //2
            0x00, //3 - номер канала
            0x00, //4
            0x01, //5
        };

        public static byte[] GetModuleNameCommand()
        {
            return _getModuleNameCommand;
        }

        public static byte[] GetReadChannelCommand(int ChannelNumber)
        {
            if (ChannelNumber < 0 || ChannelNumber > 7)
            {
                throw new ArgumentOutOfRangeException("ChannelNumber", "Неверный номер канала");
            }

            byte[] readChannelCommand = new byte[_readChannelCommandBase.Length];
            Array.Copy(_readChannelCommandBase, readChannelCommand, _readChannelCommandBase.Length);

            readChannelCommand[3] = Convert.ToByte(ChannelNumber);
            var crc = ModBusCRC.CalculateCRC(readChannelCommand);

            var readChannelCommandWithCrc = readChannelCommand.ToList();

            readChannelCommandWithCrc.Add(crc[0]);
            readChannelCommandWithCrc.Add(crc[1]);

            return readChannelCommandWithCrc.ToArray();
        }
    }
}
